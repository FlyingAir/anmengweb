<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/swiper-3.4.2.min.css">
    <link rel="stylesheet" href="css/animate.css">
    <link rel="stylesheet" href="css/index.css">
    <link rel="stylesheet" href="css/font-awesome.css">
    <link rel="stylesheet" href="css/foundation-datepicker.min.css">
</head>

<body>
    <div class="top-bar">
        <div class="wrap">
            <div class="top-items">
                <ul>
                    <li class="active-item"><a href="apply.html">预约参观</a></li>
                    <li><a href="apply-calendar.html">校行事历</a></li>
                </ul>
            </div>
            <img class="logo" src="imgs/logo.png" alt="">
        </div>
    </div>
    <div class="main-content">
        <div class="banner-content wrap">
            <div class="swiper-container main-container appointment">
                <header>预约参观</header>
                <div class="form-content">
                    <div class="form-item">
                        <span class="label-title">宝宝姓名</span>
                        <input type="text" name="name" class="baby-name">
                        <i class="statu"></i>
                        <span class="label-title" style="padding-left: 30px;">宝宝生日</span>
                        <input type="text" id="babay-birth-picker" class="baby-birth">
                        <i class="statu"></i>
                    </div>
                    <div class="form-item">
                        <span class="label-title">宝宝国籍</span>
                        <input type="text" name='country' class="baby-country">
                        <i class="statu"></i>
                        <span class="label-title" style="padding-left: 30px;">宝宝性别</span>
                        <div class="sewv sex">
                            <div class="sewvtop"><span>请选择..</span><em><img src="imgs/selebom.png"></em></div>
                            <ul class="sewvbm">
                                <li data-id="男">男</li>
                                <li data-id="女">女</li>
                            </ul>
                        </div>
                        <i class="statu"></i>
                    </div>
                    <div class="form-item">
                        <span class="label-title">家长姓名</span>
                        <input type="text" name='parentname' class="parent-name">
                        <i class="statu"></i>
                        <span class="label-title" style="padding-left: 30px;">家长联系电话</span>
                        <input type="tel" name='phone' style="width: 251px; " class="parent-tel">
                        <i class="statu" style="left:8px"></i>
                    </div>
                    <div class="form-item">
                    </div>
                    <div class="form-item">
                        <span class="label-title">家长联系邮箱</span>
                        <input type="text" name='email' style="width: 698px; " class="parent-mail">
                        <i class="statu"></i>
                    </div>
                    <div class="form-item">
                        <span class="label-title">希望参观校区</span>
                        <div class="sewv visit" style="width: 714px; ">
                            <div class="sewvtop"><span style="width: 714px; ">请选择..</span><em><img src="imgs/selebom.png"></em></div>
                            <ul class="sewvbm">
                                <li style="width: 714px; " data-id="<{$vo.id}>">上海市静安区民办安蒙幼儿园</li>
                            </ul>
                        </div>
                        <i class="statu" style="left:12px;"></i>
                    </div>
                    <div class="form-item">
                        <span class="label-title">希望参观时间</span>
                        <input type="text" id="visit-time-picker" style="width:698px;" class="visit-time">
                        <i class="statu"></i>
                    </div>
                    <div class="form-item">
                        <span class="label-title" style="float: left;margin-top: 12px;">参观原因</span>
                        <textarea name="text" id="" resize="none" style="height:74px;" class="visit-reason"></textarea>
                        <i class="statu" style="top:-68px"></i>
                    </div>
                    <div class="submit-btn">
                        <i class="iconright"></i>预约参观
                    </div>
                </div>
            </div>
            <div class="nav-content">
                <ul>
                    <li>
                        <a href="./ablout.html">
                            <div><img src="imgs/nav01-b.png" alt=""></div>
                            <header>关于我们</header>
                        </a>
                    </li>
                    <li>
                        <a href="./mengte.html">
                            <div><img src="imgs/nav02-b.png" alt=""></div>
                            <header>教学特色</header>
                        </a>
                    </li>
                    <li>
                        <a href="./apply.html">
                            <div><img src="imgs/nav03.png" alt=""></div>
                            <header>申请入学</header>
                        </a>
                    </li>
                    <li>
                        <a href="./news.html">
                            <div><img src="imgs/nav04-b.png" alt=""></div>
                            <header>最新动态</header>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
    <div class="footer-bar">
        <div class="wrap">
            <img src="imgs/foot.png" alt="" style="width:100%">
        </div>
    </div>
    <script src="js/jquery.min.js"></script>
    <script src="js/swiper-3.4.2.min.js"></script>
    <script src="js/foundation-datepicker.js"></script>
    <script src="js/foundation-datepicker.zh-CN.js"></script>
    <script src="js/sweetalert.min.js"></script>
    <script src="js/index.js"></script>
    <script>
    $(function() {
        var sexCode = "";
        var visitCode = "";
        $('.sex .sewvbm li').click(function(event) {
            sexCode = $(this).data('id')
        });
        $('.visit .sewvbm li').click(function(event) {
            visitCode = $(this).data('id')

        });
        $('#babay-birth-picker').fdatepicker({
            format: 'yyyy-mm-dd',
        });
        $('#visit-time-picker').fdatepicker({
            format: 'yyyy-mm-dd',
        });
        // 表单验证
        $('.form-item input').each(function(index, el) {
            $(el).blur(function(event) {
                console.log("me")
                if ($.trim($(el).val()) == "") {
                    $(el).next('i').removeClass().addClass('error-statu animated headShake')
                } else {
                    $(el).next('i').removeClass().addClass('success-statu animated fadeIn')
                }
            });
        });
        $('#visit-time-picker,#visit-time-picker').change(function(event) {
            if ($.trim($(this).val()) == "") {
                $(this).next('i').removeClass().addClass('error-statu animated headShake')
            } else {
                $(this).next('i').removeClass().addClass('success-statu animated fadeIn')
            }
        });
        $('textarea').blur(function(event) {
            if ($.trim($(this).val()) == "") {
                $(this).next('i').removeClass().addClass('error-statu animated headShake')
            } else {
                $(this).next('i').removeClass().addClass('success-statu animated fadeIn')
            }
        });
        $('.parent-tel').blur(function(event) {
            var reg = /^1\d{10}$/;
            if (reg.test($(this).val())) {
                $(this).next('i').removeClass().addClass('success-statu animated fadeIn')
            } else {
                $(this).next('i').removeClass().addClass('error-statu animated headShake')
            }
        });
        $('.parent-mail').blur(function(event) {
            var reg = /^(\w-*\.*)+@(\w-?)+(\.\w{2,})+$/;
            if (reg.test($(this).val())) {
                $(this).next('i').removeClass().addClass('success-statu animated fadeIn')
            } else {
                $(this).next('i').removeClass().addClass('error-statu animated headShake')
            }
        });
        $(".sewvtop span").bind("DOMNodeInserted", function(e) {
            console.log($(e.target).html())
            if ($(e.target).html() != "请选择..") {
                $(e.target).parent().parent().next('i').removeClass().addClass('success-statu animated fadeIn')
            }
        });

        $('.submit-btn').click(function(event) {
            setTimeout(function() {
                var flag = true;
                $('.form-item').find('i').each(function(index, el) {
                    if (!$(this).hasClass('success-statu')) {
                        flag = false;
                        $(this).removeClass().css('visibility', 'visible').addClass('error-statu animated headShake')
                        $('.warning-text').css('visibility', 'visible').addClass('animated headShake')
                    }
                });
                if (flag == true) {
                    var url = window.location.host;
                    var postData = {
                        babyName: $('.baby-name').val(), //宝贝姓名
                        babyBirth: $('.baby-birth').val(), //宝贝生日
                        babyCountry: $('.baby-country').val(), //宝贝国籍
                        babySex: sexCode, //宝贝性别
                        parentName: $('.parent-name').val(), //家长姓名
                        parentTel: $('.parent-tel').val(), //家长联系电话
                        parentMail: $('.parent-mail').val(), //家长联系邮箱
                        hopeVisit: visitCode, //希望参观校区
                        visitTime: $('.visit-time').val(), //希望参观时间
                        visitReason: $('.visit-reason').val(), //参观原因
                    }
                    $.ajax({
                            url: '<{:url("index/babyapply")}>',
                            type: 'POST',
                            dataType: 'json',
                            data: postData,
                        })
                        .done(function(json) {
                            if (json.code == 200) {
                                swal("预约成功。")
                                    .then((value) => {});
                            }
                        })
                        .fail(function() {
                            console.log("error");
                        })
                        .always(function() {
                            console.log("complete");
                        });
                } else {
                    var reg = /^1\d{10}$/;
                    var reg2 = /^(\w-*\.*)+@(\w-?)+(\.\w{2,})+$/;
                    if ($('.baby-name').text() == "") {
                        swal("请填写宝宝姓名。")
                            .then((value) => {});
                    } else if ($('.baby-birth').text() == "") {
                        swal("请填写宝宝生日。")
                            .then((value) => {});
                    } else if ($('.baby-country').text() == "") {
                        swal("请填写宝宝国籍。")
                            .then((value) => {});
                    } else if ($('.sex').find('span').text() == "请选择..") {
                        swal("请选择宝宝性别。")
                            .then((value) => {});
                    } else if ($('.parent-name').text() == "") {
                        swal("请填写家长姓名。")
                            .then((value) => {});
                    } else if (!reg.test($('.parent-tel').val())) {
                        swal("请核对家长联系电话。")
                            .then((value) => {});
                    } else if (!reg2.test($('.parent-mail').val())) {
                        swal("请核对家长联系邮箱。")
                            .then((value) => {});
                    } else if ($('.visit').find('span').text() == "请选择..") {
                        swal("请选择希望参观校区。")
                            .then((value) => {});
                    } else if ($('.visit-time').text() == "") {
                        swal("请填写希望参观时间。")
                            .then((value) => {});
                    } else if ($('.visit-reason').text() == "") {
                        swal("请填写参观原因。")
                            .then((value) => {});
                    } else {
                        swal("信息不全，请填写完整。")
                            .then((value) => {});
                    }
                }
            }, 100);

        });

    })
    </script>
</body>

</html>